{%extends "main.html"%}

{%block application%}


            <form  name="file" id="form" enctype="multipart/form-data" action="/files/add/" method="POST">{% csrf_token %}
                <table>
                
                {{uploadform.as_table}}
                              
                <tr>
                	<td colspan="2" align="center">
                		<input class="btn btn-success btn-block" type="submit" value="Загрузить"><br>
                	</td>
                </tr>
                </table>
            </form>


             {%for file in files%}
                <div class="file_block" id="{{file.id}}">
                    <br><li>{{file.FileName}} {{file.Uploaded_date}} <a href="/static/{{file.File}}/">Скачать</a> <a href="/files/del/{{file.id}}/">Удалить</a></li><br>
                </div>

            <script type="text/javascript">
                $("#{{file.id}}").mouseenter(function() {
                   $("#{{file.id}}").css("background-color","rgba(32, 15, 32, 0.1)"); 
                });
                $("#{{file.id}}").mouseleave(function() {
                   $("#{{file.id}}").css("background-color","#fff"); 
                });
                                
            </script>    


              {%endfor%}
            



<script>

    function resize(img){
        var canvas = document.createElement('canvas');
        var MAX_WIDTH = 800;
        var MAX_HEIGHT = 600;
        var width = img.width;
        var height = img.height;
         
        if (width > height) {
          if (width > MAX_WIDTH) {
            height *= MAX_WIDTH / width;
            width = MAX_WIDTH;
          }
        } else {
          if (height > MAX_HEIGHT) {
            width *= MAX_HEIGHT / height;
            height = MAX_HEIGHT;
          }
        }
        canvas.width = width;
        canvas.height = height;
        var ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, width, height); 
        return canvas.toDataURL("image/jpeg",0.7);    
    }


    function fileSelected(input) {
        
         if (input.files && input.files[0]) {
            var reader = new FileReader();
            
            reader.onload = function (e) {
                var img = new Image();
                img.src = e.target.result;
                 
                img.onload = function(){
                    var newinput = $("#file");                    
                    //var newinput = document.getElementById('hidfile');
                    //newinput.type = 'hidden';
                    
                    var img2 = new Image();
                    img2.src = resize(img);
                    //newinput.setAttribute('name','File');
                    var resized = resize(img);                                   
                    input.files[0] = ""; // put result from canvas into new hidden input
                    //document.getElementById('form').appendChild(newinput);               
                    alert("ddd");        
               }                 
                
            }
            
            reader.readAsDataURL(input.files[0]);
        }
        
    }
    
    //нужно сделать добавление второго файла, вместо первого. изменение вроде как работает

</script>



{%endblock%}